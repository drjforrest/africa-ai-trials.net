# Apache Virtual Host configuration for african-ai-trials.net
# Place this in Apache sites-available directory

<VirtualHost *:80>
    ServerName african-ai-trials.net
    ServerAlias www.african-ai-trials.net
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://african-ai-trials.net/
</VirtualHost>

<VirtualHost *:443>
    ServerName african-ai-trials.net
    ServerAlias www.african-ai-trials.net
    
    # SSL Configuration (Let's Encrypt)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/african-ai-trials.net/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/african-ai-trials.net/privkey.pem
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Enable compression
    LoadModule deflate_module modules/mod_deflate.so
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico|svg)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # Reverse proxy to Next.js application
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket support for Next.js hot reload (development)
    ProxyPass /_next/webpack-hmr ws://localhost:3000/_next/webpack-hmr
    ProxyPassReverse /_next/webpack-hmr ws://localhost:3000/_next/webpack-hmr
    
    # Main application proxy
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Set headers for proxied requests
    ProxyPassReverse / http://localhost:3000/
    ProxyPreserveHost On
    ProxyAddHeaders On
    
    # Static file caching
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header append Cache-Control "public, immutable"
    </LocationMatch>
    
    # HTML file caching
    <LocationMatch "\.html$">
        ExpiresActive On
        ExpiresDefault "access plus 1 day"
        Header append Cache-Control "public, must-revalidate"
    </LocationMatch>
    
    # API responses - no caching
    <LocationMatch "/api/">
        ExpiresActive Off
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </LocationMatch>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/african-ai-trials.net_error.log
    CustomLog ${APACHE_LOG_DIR}/african-ai-trials.net_access.log combined
</VirtualHost>